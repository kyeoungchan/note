# 절차형 SQL
- 일반적인 언어형식과 같이 절차적으로 명령을 수행하는 SQL
- DBMS 엔진에서 실행되고 단일 SQL 문장으로 실행하기 어려운 연속적인 작업 처리가 가능하다.
- 로직을 캡슐화할 수 있기 때문에 반복적인 DB 작업을 효율적으로 수행하고 소프트웨어 개발 생산성을 높인다는 장점이 있다.

## 프로시저(Procedure)
- 일련의 쿼리들을 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합
- 자주 사용되는 SQL문을 DB 객체로 생성하여 저장한 후 필요시 프로시저명을 호출해서 사용할 수 있다.
```sql
CREATE OR REPLACE PROCEURE {프로시저명} 
       ({파라미터명} [IN\OUT\INOUT 중에 선택] {데이터 타입}, ...)
IS
    변수선언 
BEGIN	//프로시저 시작
	명령어;
[COMMIT\ROLLBACK]
END; // 프로시저 끝
```
- [OR REPLACE] : 기존 프로시저 존재시 현재 컴파일 하는 내용으로 덮어씀
- [IN|OUT|INOUT] : 변수의 입출력 구분, (운영체제에서 프로시저로 값을 전달하는 모드/프로시저에서 처리된 결과를 운영체제로 전달하는 모드/두가지 기능을 동시에 수행)
- BEGIN : 프로시저의 시작 
- COMMIT : 하나의 트랜잭션이 성공적으로 끝나고, 데이터베이스가 일관성 있는 상태에 있을 때 하나의 트랜잭션이 끝났을 때 사용하는 연산 
- ROLLBACK : 하나의 트랜잭션이 비정상적으로 종료되어 트랜잭션 원자성이 깨질 경우 처음부터 다시 시작하거나, 부분적으로 연산을 취소하는 연산 
- END : 프로시저의 끝

## 사용자 정의 함수(User-Defined Function)
- 일련의 SQL 처리를 수행하고, 수행 결과를 단일 값으로 반환할 수 있는 절차형 SQL
  - 기본적인 사항은 프로시저와 동일하고, 반환에서의 부분만 프로시저와 다르다.
```sql
CREATE [OR REPLACE] FUNCTION 함수명
(파라미터명 IN 데이터타입, ... ... ) 
RETURN 데이터타입
IS 
	변수선언
BEGIN
	명령어;
   	RETURN 변수;
[COMMIT|ROLLBACK]
END;
```
- RETURN 데이터타입 : 사용자 정의함수가 반환하는 데이터 타입을 정의
- RETURN 데이터값 : 사용자 정의함수가 종료될 때 반환하는 단일 값을 정의

## 트리거(Trigger)
- 데이터베이스 시스템에서 삽입, 생신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL
- 이벤트는 전체 트랜잭션 대상과 각 행에 의해 발생하는 경우 모두를 포함할 수 있다.
  - 테이블과 뷰, DB 작업을 대상으로 정의할 수 있다.
- 목적
  - 데이터 무결성 유지 및 로그 메시지 출력 등의 별도 처리를 위해 트리거 사용
  - 이벤트와 관련된 테이블의 데이터 삽입, 추가, 삭제 작업을 DBMS가 자동적으로 실행시키는 데 활용
- 종류
  - 행 트리거: 데이터 변화가 생길 때마다 실행
  - 문장 트리거: 트리거에 의해 단 한 번 실행
```sql
CREATE [OR REPLACE] TRIGGER 트리거명
[BEFORE|AFTER] 유형 ON 테이블명
[FOR EACH ROW]
BEGIN
END;
```
- [BEFORE|AFTER] : DML과 트리거가 실행되는 순서의 전후 관계를 결정
- [FOR EACH ROW] : 매번 변경되는 데이터 행의 수만큼 실행을 위한 명령어

### 프로시저 vs. 트리거
프로시저
- CREATE 프로시저 문법 사용
- EXECUTE 명령어로 실행
- COMMIT, ROLLBACK 실행 가능

트리거
- CREATE 트리거 문법 사용
- 생성 후 자동 실행
- COMMIT, ROLLBACK 실행시 컴파일 에러

출처  
[절차형 SQL 개념 및 종류(프로시저, 사용자정의함수, 트리거)](https://for-it-study.tistory.com/67)  
[제 8절 절차형 SQL](https://velog.io/@suyeon-jung/%EC%A0%9C-8%EC%A0%88-%EC%A0%88%EC%B0%A8%ED%98%95-SQL)