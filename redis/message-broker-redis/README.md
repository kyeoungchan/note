# π’» λ λ””μ¤λ¥Ό λ©”μ‹μ§€ λΈλ΅μ»¤λ΅
**βπ» λ©”μ‹μ§€ λΈλ΅μ»¤**  
μµκ·Όμ μ„λΉ„μ¤ μ•„ν‚¤ν…μ²λ” μ—¬λ¬ λ¨λ“μ΄ μ„λ΅ λμ¨ν•κ³  μ μ ν•κ² μ—°κ²°μ‹ν‚¨ κµ¬μ΅°λ¥Ό μ„ νΈν•κ³  μλ‹¤.  
λ¨λ“ κ°„ μ„λ΅ νƒ„νƒ„ν• μƒνΈ μ‘μ©μ΄ ν•„μ”ν•κΈ° λ•λ¬Έμ— ν¨μ¨μ μΈ λ©”μ‹μ§• μ†”λ£¨μ…, μ¦‰ λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό ν•„μ”λ΅ ν•λ‹¤.  

μ„λΉ„μ¤ κ°„ μ»¤λ„¥μ…μ΄ μ‹¤ν¨ν•λ” μƒν™©μ€ μ–Έμ λ‚ λ°μƒν•  μ μλ‹¤.   
β΅ λ¨λ“ κ°„μ ν†µμ‹ μ—μ„λ” λλ„λ΅ λΉ„λ™κΈ°(async) ν†µμ‹ μ„ μ‚¬μ©ν•κ±°λ‚, λ™κΈ°(sync) ν†µμ‹ μ νμλ¥Ό μµλ€ν• μ¤„μ΄λ” κ²ƒμ΄ λ°”λμ§ν•λ‹¤.  
λ‹Ήμ¥ λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•μ§€ λ»ν•λ”λΌλ„ λ³΄λ‚Έ λ©”μ‹μ§€λ¥Ό μ–΄λ”κ°€μ— μ“μ•„λ‘” λ’¤ λ‚μ¤‘μ— μ²λ¦¬ν•  μ μλ” μ±„λ„μ„ λ§λ“¤μ–΄μ£Όλ” κ²ƒμ΄ λ°”λ΅ **λ©”μ‹μ§€ λΈλ΅μ»¤μ ν•µμ‹¬ μ—­ν• **μ΄λ‹¤.

<br>

## π’΅λ©”μ‹μ§• νμ™€ μ΄λ²¤νΈ μ¤νΈλ¦Ό 
|               κΈ°μ¤€                | λ©”μ‹μ§• ν                                                    | μ΄λ²¤νΈ μ¤νΈλ¦Ό                                                       |
|:-------------------------------:|----------------------------------------------------------|---------------------------------------------------------------|
|               μ©μ–΄                | μƒμ‚°μ(producer): λ°μ΄ν„°λ¥Ό μƒμ„±ν•λ” μ½ <br> μ†λΉ„μ(consumer): λ°μ΄ν„°λ¥Ό μμ‹ ν•λ” μ½ | λ°ν–‰μ(publisher): λ°μ΄ν„°λ¥Ό μƒμ„±ν•λ” μ½ <br> κµ¬λ…μ(subscriber): λ°μ΄ν„°λ¥Ό μμ‹ ν•λ” μ½ |
|               λ°©ν–¥μ„±               |μƒμ‚°μλ” μ†λΉ„μμ νλ΅ λ°μ΄ν„°λ¥Ό μ§μ ‘ ν‘Έμ‹ν•λ‹¤. <br> 2κ°μ μ„λΉ„μ¤μ— κ°™μ€ λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄μ•Ό ν•  λ• μƒμ‚°μλ” 2κ°μ κ°κ° λ‹¤λ¥Έ λ©”μ‹μ§• νμ— κ°κ° λ°μ΄ν„°λ¥Ό ν‘Έμ‹ν•΄μ•Ό ν•λ‹¤.|λ°ν–‰μλ” μ¤νΈλ¦Όμ νΉμ • μ €μ¥μ†μ— ν•λ‚μ λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό μ μκ³ , κµ¬λ…μλ“¤μ€ μ¤νΈλ¦Όμ—μ„ κ°™μ€ λ©”μ‹μ§€λ¥Ό pullν•΄κ° μ μκΈ° λ•λ¬Έμ— λ©”μ‹μ§€λ¥Ό λ³µμ ν•΄μ„ μ €μ¥ν•μ§€ μ•μ•„λ„ λλ‹¤.|
|            λ°μ΄ν„°μ μμ†μ„±             |μ†λΉ„μκ°€ λ°μ΄ν„°λ¥Ό μ½μ–΄κ° λ• νμ—μ„ λ°μ΄ν„°λ¥Ό μ‚­μ ν•λ‹¤.|κµ¬λ…μκ°€ μ½μ–΄κ°„ λ°μ΄ν„°λ” λ°”λ΅ μ‚­μ λμ§€ μ•κ³ , μ €μ¥μ†μ μ„¤μ •μ— λ”°λΌ νΉμ • κΈ°κ°„ λ™μ• μ €μ¥λ  μ μλ‹¤.|
| νμ¤ν† λ¦¬(λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄λ” λ„μ¤‘ μƒλ΅μ΄ μ†λΉ„μκ°€ μ¶”κ°€λλ©΄) |μ†λΉ„μλ” μƒλ΅­κ² μ¶”κ°€λ μ΄ν›„μ μ΄λ²¤νΈλ§ ν™•μΈν•  μ μλ‹¤.|μ¤νΈλ¦Όμ— μ“μΈ λ°μ΄ν„°λ” μΌμ •κΈ°κ°„ μ§€μ›μ§€μ§€ μ•κΈ° λ•λ¬Έμ— μƒλ΅ μ¶”κ°€λ μ„λΉ„μ¤λ„ μ΄μ „ λ°μ΄ν„°μ νμ¤ν† λ¦¬λ¥Ό λ³Ό μ μλ‹¤.| 
|μ ν•©μ„±|μΌλ€μΌ μƒν™©μ—μ„ μ λ¦¬ν•λ‹¤.|λ‹¤λ€λ‹¤ μƒν™©μ—μ„ μ λ¦¬ν•λ‹¤.|

<br>

### β… λ λ””μ¤λ¥Ό λ©”μ‹μ§€ λΈλ΅μ»¤λ΅ μ‚¬μ©ν•κΈ°
**`pub/sub`**  
λ λ””μ¤μ—μ„ μ κ³µν•λ” `pub/sub`λ¥Ό μ‚¬μ©ν•λ©΄ λΉ λ¥΄κ³  κ°„λ‹¨ν• λ°©μ‹μΌλ΅ λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•  μ μλ‹¤.
λ λ””μ¤μ `pub/sub`μ—μ„ λ¨λ“  λ°μ΄ν„°λ” ν• λ² μ±„λ„ μ „μ²΄μ— μ „νλ λ’¤ μ‚­μ λλ” μΌνμ„±μ νΉμ§•μ„ κ°€μ§€λ©°, λ©”μ‹μ§€κ°€ μ μ „λ‹¬λλ”μ§€ λ“±μ μ •λ³΄λ” λ³΄μ¥ν•μ§€ μ•λ”λ‹¤.  
β΅ `fire-and-forget` ν¨ν„΄μ΄ ν•„μ”ν• κ°„λ‹¨ν• μ•λ¦Ό μ„λΉ„μ¤μ—μ„λ” μ μ©ν•κ² μ‚¬μ©λ  μ μλ‹¤.  

> `fire-and-forget`  
> λΉ„λ™κΈ° ν”„λ΅κ·Έλλ°μ—μ„ μ‚¬μ©λλ” λ””μμΈ ν¨ν„΄μΌλ΅, μ–΄λ–¤ μ‘μ—…μ„ μν–‰ν•κ³  κ·Έ κ²°κ³Όμ— λ€ν• μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬μ§€ μ•κ³  λ°”λ΅ λ‹¤μ μ½”λ“¤λ¥΄ μ‹¤ν–‰ν•λ” κ²ƒμ„ λ§ν•λ‹¤.  
> λ΅κΉ…, μ΄λ²¤νΈ λ°ν–‰, ν†µκ³„ λ°μ΄ν„° μμ§‘κ³Ό κ°™μ΄ μ‘μ—…μ μ„±κ³µ λλ” μ‹¤ν¨μ— λ€ν• κ΄€μ‹¬μ΄ μ—†λ” κ²½μ°μ— ν™μ©λ  μ μλ‹¤.  
> μ‹ λΆ°μ„±μ΄ ν•„μ”ν• κ²½μ°μ—λ” μ‚¬μ©ν•μ§€ μ•μ•„μ•Ό ν•λ‹¤.

<br>

**`list` μλ£ κµ¬μ΅°**  
λ λ””μ¤μ `list` μλ£ κµ¬μ΅°λ” λ©”μ‹μ§• νλ΅ μ‚¬μ©ν•κΈ°μ— μ•λ§λ‹¤.  
pushμ™€ popμ΄ κ°€λ¥ν•λ©°, λ€κΈ°ν•λ‹¤κ°€ `list`μ— μƒλ΅μ΄ λ°μ΄ν„°κ°€ λ“¤μ–΄μ¤λ©΄ μ½μ–΄κ° μ μλ” λΈ”λ΅ν‚Ή κΈ°λ¥μ„ μ‚¬μ©ν•  μλ„ μλ‹¤.  

<br>

**`stream` μλ£ κµ¬μ΅°**  
λ λ””μ¤λ¥Ό μ™„λ²½ν• μ¤νΈλ¦Ό ν”λ«νΌμΌλ΅ μ‚¬μ©ν•  μ μλ‹¤.  
λ λ””μ¤ `stream`μ€ μ•„νμΉ [`kafka` μ‹μ¤ν…](https://github.com/kyeoungchan/note/tree/main/kafka)μ—μ„ μκ°μ„ λ°›μ•„ λ§λ“¤μ–΄μ§„ μλ£ κµ¬μ΅°λ΅, λ°μ΄ν„°λ” κ³„μ†ν•΄μ„ μ¶”κ°€λλ” λ°©μ‹μΌλ΅ μ €μ¥λλ‹¤(append-only).  
μ†λΉ„μμ™€ μ†λΉ„μ κ·Έλ£Ήμ΄λΌλ” κ°λ…μ„ μ΄μ©ν•λ©΄ μΉ΄ν”„μΉ΄μ—μ„μ™€ λΉ„μ·ν•κ² λ°μ΄ν„°μ λ¶„μ‚° μ²λ¦¬λ¥Ό κµ¬ν„ν•  μ μλ‹¤.  
`stream`μ— μ €μ¥λλ” λ©”μ‹μ§€λ¥Ό μ‹¤μ‹κ°„μΌλ΅ λ¦¬μ¤λ‹ν•λ©΄μ„ μ†λΉ„ν•  μ μκ³ , μ €μ¥λΌμλ” λ°μ΄ν„°λ¥Ό μ‹κ°„λ€λ³„λ΅ κ²€μƒ‰ν•λ” κ²ƒλ„ κ°€λ¥ν•λ‹¤.  

<br>

## π’΅ λ λ””μ¤μ `pub/sub`
![pub_sub.jpeg](../res/pub_sub.jpeg)  
λ λ””μ¤ λ…Έλ“μ— μ ‘κ·Όν•  μ μλ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈλ” λ°ν–‰μμ™€ κµ¬λ…μκ°€ λ  μ μλ‹¤.  
λ°ν–‰μλ” νΉμ • μ±„λ„μ— λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό μ μμΌλ©°, κµ¬λ…μλ” νΉμ • μ±„λ„μ„ λ¦¬μ¤λ‹ν•λ‹¤κ°€ λ©”μ‹μ§€λ¥Ό μ½μ–΄κ° μ μλ‹¤.  

μ„μ—μ„ λ§ν–λ‹¤μ‹ν”Ό, λ§¤μ° κ°€λ³κΈ° λ•λ¬Έμ— μµμ†ν•μ λ©”μ‹μ§€ μ „λ‹¬ κΈ°λ¥λ§ μ κ³µν•λ‹¤.
- λ°ν–‰μλ” μ–΄λ–¤ κµ¬λ…μκ°€ λ©”μ‹μ§€λ¥Ό μ½μ–΄κ°€λ”μ§€, μ •μƒμ μΌλ΅ λ¨λ“  κµ¬λ…μμ—κ² λ©”μ‹μ§€κ°€ μ „λ‹¬λλ”μ§€ ν™•μΈ ν•  μ μ—†λ‹¤.
- κµ¬λ…μ λν• ν•΄λ‹Ή λ©”μ‹μ§€κ°€ μ–Έμ  μ–΄λ–¤ λ°ν–‰μμ— μν•΄ μƒμ„±λλ”μ§€ λ“±μ λ©”νƒ€λ°μ΄ν„°λ” μ• μ μ—†λ‹¤.

μ •ν•©μ„±μ΄ μ¤‘μ”ν• λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•κΈ°μ—λ” μ ν•©ν•μ§€ μ•μΌλ©°, μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨μ—μ„ λ©”μ‹μ§€μ μ†΅μμ‹ κ³Ό κ΄€λ ¨ν• λ΅μ§μ„ μ¶”κ°€ν•΄μ•Όν•  μ μλ‹¤.

### β… λ©”μ‹μ§€ publishν•κΈ°
```shell
127.0.0.1:6379> PUBLISH hello world
0
```
μ„μ μ»¤λ§¨λ“λ¥Ό μν–‰ν•λ©΄ `hello`λΌλ” μ±„λ„μ„ μμ‹ ν•κ³  μλ” λ¨λ“  μ„λ²„λ“¤μ— `world`λΌλ” λ©”μ‹μ§€κ°€ μ „νλλ‹¤.  
λ©”μ‹μ§€κ°€ μ „νλ ν›„μ—λ” λ©”μ‹μ§€λ¥Ό μμ‹ ν• κµ¬λ…μμ μκ°€ λ°ν™λλ‹¤.  

<br>

### β… λ©”μ‹μ§€ subscribeν•κΈ°
```shell
127.0.0.1:6379> SUBSCRIBE event1 event2
subscribe
event1
1
subscribe
event2
2
```
ν΄λΌμ΄μ–ΈνΈκ°€ μ„μ μ»¤λ§¨λ“λ¥Ό μν–‰ν•λ©΄ event1κ³Ό event2 μ±„λ„μ„ λ™μ‹μ— κµ¬λ…ν•κΈ° μ‹μ‘ν•λ‹¤.  
ν΄λΌμ΄μ–ΈνΈκ°€ κµ¬λ…μλ΅ λ™μ‘ν•  λ•μ—λ” μƒλ΅μ΄ μ±„λ„μ„ κµ¬λ…ν•  μ μμ§€λ§ `pub/sub`κ³Ό κ΄€λ ¨λμ§€ μ•μ€ λ‹¤λ¥Έ μ»¤λ§¨λ“λ” μν–‰ν•  μ μ—†λ‹¤.  

<br>

ssh μ°½μ„ 2κ°λ¥Ό λ„μ›μ„, ν•λ‚λ” λ°ν–‰, ν•λ‚λ” κµ¬λ…ν•΄λ³΄μ.  
κ°™μ€ redis νμΌμ„ 2λ² μ‹¤ν–‰μ‹ν‚¤λ©΄ λλ‹¤.
```shell
# λ°ν–‰μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> PUBLISH event1 hello
1
127.0.0.1:6379> PUBLISH event1 hello2
1
127.0.0.1:6379> PUBLISH event2 hello3
1
```
```shell
# κµ¬λ…μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> SUBSCRIBE event1 event2
subscribe
event1
1
subscribe
event2
2

# hello λ©”μ‹μ§€ μμ‹ 
message
event1
hello

# hello2 λ©”μ‹μ§€ μμ‹  
message
event1
hello2

# hello3 λ©”μ‹μ§€ μμ‹ 
message
event2
hello3
```

<br>

`PSUBSCRIBE` μ»¤λ§¨λ“λ¥Ό μ‚¬μ©ν•λ©΄ μΌμΉν•λ” ν¨ν„΄μ— ν•΄λ‹Ήν•λ” μ±„λ„μ„ ν• λ²μ— κµ¬λ…ν•  μ μλ‹¤.  
μ΄λ• λ λ””μ¤λ” glob-style ν¨ν„΄μ„ μ§€μ›ν•λ‹¤.  
μ΄λ• λ©”μ‹μ§€λ” `message`κ°€ μ•„λ‹ `pmessage` νƒ€μ…μΌλ΅ μ „λ‹¬λλ‹¤.  
```shell
# λ°ν–‰μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> PUBLISH mail-1 hello~!
1
```
```shell
# κµ¬λ…μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> PSUBSCRIBE mail-*
psubscribe
mail-*
1
pmessage
mail-*
mail-1
hello~!
```
λ§μ•½ κµ¬λ…μκ°€ `SUBSCRIBE mail-1`κ³Ό `PSUBSCRIBE mail-*`μ„ λ™μ‹μ— κµ¬λ…ν•κ³  μμ„ λ• `mail-1` μ±„λ„μ— λ©”μ‹μ§€κ°€ λ°ν–‰λλ©΄ κµ¬λ…μλ” 2κ°μ λ©”μ‹μ§€λ¥Ό λ°›κ² λλ‹¤.  

<br>

### β… ν΄λ¬μ¤ν„° κµ¬μ΅°μ—μ„μ pub/sub
λ λ””μ¤ ν΄λ¬μ¤ν„° κµ¬μ΅°μ—μ„λ„ `pub/sub`μ„ μ‚¬μ©ν•  μ μλ‹¤.  
ν΄λ¬μ¤ν„°λ” λ λ””μ¤κ°€ μμ²΄μ μΌλ΅ μ κ³µν•λ” λ°μ΄ν„° λ¶„μ‚° ν•νƒμ κµ¬μ΅°λ‹¤.  
λ λ””μ¤ ν΄λ¬μ¤ν„°μ—μ„ `pub/sub`μ„ μ‚¬μ©ν•  λ•, λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•λ©΄ ν•΄λ‹Ή λ©”μ‹μ§€λ” ν΄λ¬μ¤ν„°μ— μ†ν• λ¨λ“  λ…Έλ“μ— μλ™μΌλ΅ μ „λ‹¬λλ‹¤.  
λ”°λΌμ„ λ λ””μ¤ ν΄λ¬μ¤ν„°μ μ•„λ¬΄ λ…Έλ“μ— μ—°κ²°ν•΄ `SUBSCRIBE` μ»¤λ§¨λ“λ¥Ό μ‚¬μ©ν•λ©΄ λ°μ΄ν„°λ¥Ό μμ‹ ν•  μ μλ‹¤.  

![cluster_pub_sub.jpeg](../res/cluster_pub_sub.jpeg)  

<br>

**ν΄λ¬μ¤ν„°μ λ©μ μ—λ” λ¶€ν•©ν•μ§€ μ•λ” λ°©μ‹**  
ν΄λ¬μ¤ν„°λ” μ£Όλ΅ λ€κ·λ¨ μ„λΉ„μ¤μ—μ„ λ°μ΄ν„°λ¥Ό λ¶„μ‚°ν•΄μ„ μ €μ¥ν•κ³  μ²λ¦¬ν•κΈ° μ„ν•΄ λ„μ…λλ‹¤.  
β΅ λ λ””μ¤ ν΄λ¬μ¤ν„° λ‚΄μ—μ„ `pub/sub`μ„ μ‚¬μ©ν•  λ• λ©”μ‹μ§€κ°€ λ¨λ“  λ λ””μ¤ λ…Έλ“μ— λ³µμ λλ” λ°©μ‹μ€ ν΄λ¬μ¤ν„° ν™κ²½μ ν•µμ‹¬ λ©ν‘μ™€λ” λ¶€ν•©ν•μ§€ μ•μΌλ©°, μ΄λ΅ μΈν•΄ λ¶ν•„μ”ν• λ¦¬μ†μ¤ μ‚¬μ©κ³Ό λ„¤νΈμ›ν¬ λ¶€ν•κ°€ λ°μƒν•  μ μλ‹¤.

<br>

### β… sharded pub/sub
λ λ””μ¤ 7.0μ—μ„λ” `sharded pub/sub` κΈ°λ¥μ΄ λ„μ…λλ‹¤.  
`sharded pub/sub` ν™κ²½μ—μ„ κ° μ±„λ„μ€ μ¬λ΅―μ— λ§¤ν•‘λλ‹¤.  
ν΄λ¬μ¤ν„°μ—μ„ ν‚¤κ°€ μ¬λ΅―μ— ν• λ‹Ήλλ” κ²ƒκ³Ό λ™μΌν• λ°©μ‹μΌλ΅ μ±„λ„μ΄ ν• λ‹Ήλλ©°, κ°™μ€ μ¬λ΅―μ„ κ°€μ§€κ³  μλ” λ…Έλ“ κ°„μ—λ§ `pub/sub` λ©”μ‹μ§€λ¥Ό μ „νν•λ‹¤.  

![sharded_pub_sub.jpeg](../res/sharded_pub_sub.jpeg)  

```shell
# λ°ν–‰μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> SPUBLISH apple a
0
```
```shell
# μμ‹ μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> SSUBSCRIBE apple
ssubscribe
apple
1
```
```shell
# λ°ν–‰μ ν΄λΌμ΄μ–ΈνΈ
127.0.0.1:6379> SPUBLISH apple a
1
```
```shell
smessage
apple
a
```

<br>

apple μ±„λ„μ€ apple ν‚¤ κ°’μ„ ν• λ‹Ή λ°›μ„ μ μλ” μ¬λ΅―μ„ ν¬ν•¨ν• λ§μ¤ν„° λ…Έλ“μ— μ—°κ²°λ  μ μλ„λ΅ λ¦¬λ‹¤μ΄λ ‰νΈλλ‹¤.  
`sharded pub/sub`λ¥Ό μ‚¬μ©ν•λ‹¤λ©΄ ν΄λ¬μ¤ν„° κµ¬μ΅°μ—μ„ `pub/sub` λλ” λ©”μ‹μ§€λ” λ¨λ“  λ…Έλ“λ΅ μ „νλμ§€ μ•κΈ° λ•λ¬Έμ— λ¶ν•„μ”ν• λ³µμ λ¥Ό μ¤„μ—¬ μμ›μ„ μ μ•½ν•  μ μλ‹¤λ” μ¥μ μ΄ μλ‹¤.  

<br>








<br>

**μ°Έκ³  μλ£**  
[κ°λ°μλ¥Ό μ„ν• λ λ””μ¤](https://product.kyobobook.co.kr/detail/S000210785682)